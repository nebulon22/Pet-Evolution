<!DOCTYPE html>
<html>
<head>
  <title>Pet Evolusi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { margin:0; text-align:center; background:#2e7d32; color:white;
           font-family:sans-serif; overflow-x:hidden; display:flex;
           flex-direction:column; align-items:center; }
    h2 { margin-top:10px; font-size:6vw; }

    #coinDisplay { position:fixed; top:5px; left:5px; font-size:4vw;
      background:rgba(0,0,0,0.3); padding:4px 8px; border-radius:6px; z-index:10; }

    .pet-wrapper { position:relative; display:flex; align-items:center;
      justify-content:center; margin-top:10px; gap:20px; }

    /* Piring + drop zone */
    #plateWrapper { position:relative; margin:10px auto 0; width:120px; height:120px; }
    #plate { width:100%; height:auto; display:block; }
    #plateFood { position:absolute; top:25%; left:25%; width:50%; height:50%; }
    #dropZone { position:absolute; top:25%; left:25%; width:50%; height:50%; border-radius:50%; }

    /* Inventory */
    .inventory { display:flex; justify-content:center; margin-top:8px; gap:20px; }
    .food-item { position:relative; width:50px; height:50px; }
    .food-item img { width:100%; height:auto; }
    .count { position:absolute; bottom:0; right:0; background:black; color:white;
      font-size:12px; padding:2px 5px; border-radius:8px; }

    /* Glow & evo effect */
    .glow { position:absolute; width:200px; height:200px;
      background:radial-gradient(circle, rgba(255,255,200,0.8) 0%, transparent 70%);
      animation:glow 2s infinite; border-radius:50%; z-index:0; display:none; }
    @keyframes glow { 0%,100%{opacity:0; transform:scale(1);}
                      50%{opacity:0.8; transform:scale(1.2);} }

    #pet { width:40vw; max-width:220px; height:auto; z-index:1; }

    /* Bubble */
    #bubble { position:absolute; left:60%; top:20%; background:white; color:black;
      padding:8px 12px; border-radius:12px; display:none; max-width:180px;
      text-align:left; z-index:3; font-size:3.5vw; }
    #bubble::after { content:""; position:absolute; left:-10px; top:20px;
      border-width:10px; border-style:solid;
      border-color:transparent white transparent transparent; }

    /* Thermometer bar */
    .thermometer { display:flex; flex-direction:column-reverse;
      width:40px; height:220px; border:2px solid #ccc; border-radius:6px;
      overflow:hidden; background:#666; position:relative; }
    .bar { flex:1; margin:1px 0; background:#666; }
    .bar.active { opacity:1; }
    .bar:nth-child(2).active{background:#800000;}
    .bar:nth-child(3).active{background:#b22222;}
    .bar:nth-child(4).active{background:#ff4500;}
    .bar:nth-child(5).active{background:#ff8c00;}
    .bar:nth-child(6).active{background:#ffd700;}
    .bar:nth-child(7).active{background:#f0e68c;}
    .bar:nth-child(8).active{background:#adff2f;}
    .bar:nth-child(9).active{background:#7fff00;}
    .bar:nth-child(10).active{background:#32cd32;}
    .bar:nth-child(11).active{background:#00ff00;}
    .thermo-label { position:absolute; left:50%; transform:translateX(-50%);
      font-size:2.8vw; color:white; text-shadow:1px 1px 2px black; }
    #labelTop { top:2px; } #labelBottom { bottom:2px; }

    .bar-container { width:80vw; max-width:500px; margin:10px auto;
      background:#444; border-radius:10px; overflow:hidden; height:24px; }
    #expBar { height:100%; width:0%; text-align:center; color:white;
      font-size:3.5vw; line-height:24px; background:dodgerblue;
      transition:width 0.5s ease; }

    button { margin:10px; padding:12px 24px; font-size:4vw; border-radius:10px; }
    button:disabled { opacity:0.5; background:#777 !important; cursor:not-allowed; }

    #resetWrapper { position:fixed; top:5px; right:5px; z-index:10; }
    #resetBtn { font-size:2.5vw; padding:4px 8px; border-radius:6px; opacity:0.6; }
    #resetBtn:hover { opacity:1; }

    @keyframes breathing { 0%,100%{transform:scale(1);}
                           50%{transform:scale(1.05);} }
    @keyframes hungry-shake { 0%,100%{transform:translateX(0);}
                              25%{transform:translateX(-10px);}
                              75%{transform:translateX(10px);} }
    .breathing{animation:breathing 3s infinite;}
    .hungry{animation:hungry-shake 0.5s infinite;}
  </style>
</head>
<body>
  <h2>üê£ Pet Evolusi</h2>
  <div id="coinDisplay">üí∞ 0</div>

  <div class="pet-wrapper" id="petWrapper">
    <div class="thermometer" id="thermometer">
      <div id="labelTop" class="thermo-label">Kenyang</div>
      <div class="bar"></div><div class="bar"></div><div class="bar"></div>
      <div class="bar"></div><div class="bar"></div><div class="bar"></div>
      <div class="bar"></div><div class="bar"></div><div class="bar"></div>
      <div class="bar"></div>
      <div id="labelBottom" class="thermo-label">Lapar</div>
    </div>

    <div class="glow" id="evoGlow"></div>
    <img id="pet" src="images/egg.png" class="breathing">
    <div id="bubble"></div>
  </div>

  <!-- Piring + makanan aktif -->
  <div id="plateWrapper">
    <img id="plate" src="images/plate.png" alt="Piring Kosong">
    <img id="plateFood" src="" alt="">
    <div id="dropZone"></div>
  </div>

  <!-- Inventory -->
  <div class="inventory">
    <div class="food-item" id="foodMeat"><img src="images/meat.png"><div class="count" id="countMeat">100</div></div>
    <div class="food-item" id="foodFruit"><img src="images/fruit.png"><div class="count" id="countFruit">100</div></div>
    <div class="food-item" id="foodLeaf"><img src="images/leaf.png"><div class="count" id="countLeaf">100</div></div>
  </div>

  <p style="font-size:4vw;">Level Pet: <span id="level">1</span></p>
  <div class="bar-container"><div id="expBar">EXP 0%</div></div>

  <button onclick="feedPet()" id="feedBtn">üçñ Feed</button>
  <button id="evoBtn" style="display:none;" onclick="evolvePet()">‚ú® Evo Sekarang!</button>

  <div id="resetWrapper"><button id="resetBtn" onclick="resetGame()">üîÑ</button></div>

  <!-- Audio -->
  <audio id="soundFeed" src="sounds/feed.mp3" preload="auto"></audio>
  <audio id="soundLevel" src="sounds/levelup.mp3" preload="auto"></audio>
  <audio id="soundEvo" src="sounds/evo.mp3" preload="auto"></audio>

<script>
let pet = JSON.parse(localStorage.getItem("petData")) || { level:1, exp:0, stage:"egg", hunger:30, coins:0 };
let inventory = { meat:100, fruit:100, leaf:100 };
let selectedFood = null;

function getPetImage(stage){
  switch(stage){
    case "egg": return "images/egg.png";
    case "chick": return "images/chick.png";
    case "rooster": return "images/rooster.png";
    case "phoenix": return "images/phoenix.png";
    default: return "images/egg.png";
  }
}

function updateUI(){
  document.getElementById("level").textContent = pet.level;
  document.getElementById("pet").src = getPetImage(pet.stage);

  const bars = document.querySelectorAll("#thermometer .bar");
  const activeBars = Math.round(pet.hunger / 10);
  bars.forEach((bar,i)=>{ i<activeBars ? bar.classList.add("active") : bar.classList.remove("active"); });

  const expBar = document.getElementById("expBar");
  expBar.style.width = pet.exp + "%";
  expBar.textContent = "EXP " + pet.exp + "%";

  document.getElementById("coinDisplay").textContent = "üí∞ " + (pet.coins || 0);
  document.getElementById("countMeat").textContent = inventory.meat;
  document.getElementById("countFruit").textContent = inventory.fruit;
  document.getElementById("countLeaf").textContent = inventory.leaf;

  localStorage.setItem("petData", JSON.stringify(pet));
}

function showBubble(text){
  const bubble=document.getElementById("bubble");
  bubble.textContent=text; bubble.style.display="block";
  setTimeout(()=>bubble.style.display="none",2500);
}

function playSound(id){
  const s=document.getElementById(id);
  if(s){ s.currentTime=0; s.play(); }
}

function feedPet(){
  if(!selectedFood){ showBubble("Taruh makanan di piring dulu üçΩÔ∏è"); return; }
  if(inventory[selectedFood]<=0){
    showBubble("Stok habis!"); 
    document.getElementById("plateFood").src="";
    selectedFood=null;
    return;
  }

  inventory[selectedFood]--;
  pet.hunger=Math.min(100,pet.hunger+20);
  pet.coins+=1;
  playSound("soundFeed");

  if(pet.exp>=100){
    const isEvo=(pet.level===10&&pet.stage==="egg")||(pet.level===20&&pet.stage==="chick")||(pet.level===30&&pet.stage==="rooster");
    if(isEvo){
      document.getElementById("evoBtn").style.display="inline-block";
      document.getElementById("evoGlow").style.display="block";
      showBubble("EXP penuh! Tekan Evo Sekarang!");
    }else{
      pet.exp=0; pet.level++;
      playSound("soundLevel");
      showBubble("Level naik! Sekarang "+pet.level);
    }
  } else {
    pet.exp=Math.min(100,pet.exp+10);
    if(pet.exp===100){ showBubble("EXP penuh!"); }
  }

  if(inventory[selectedFood]<=0){
    document.getElementById("plateFood").src="";
    selectedFood=null;
  }

  updateUI();
}

function evolvePet(){
  if(pet.level===10&&pet.stage==="egg"){ pet.stage="chick"; showBubble("üê• Anak Ayam!"); }
  else if(pet.level===20&&pet.stage==="chick"){ pet.stage="rooster"; showBubble("üêì Ayam Jantan!"); }
  else if(pet.level===30&&pet.stage==="rooster"){ pet.stage="phoenix"; showBubble("üî• Phoenix!"); }
  pet.exp=0;
  document.getElementById("evoBtn").style.display="none";
  document.getElementById("evoGlow").style.display="none";
  playSound("soundEvo");
  updateUI();
}

function resetGame(){
  localStorage.removeItem("petData");
  pet={level:1,exp:0,stage:"egg",hunger:30,coins:0};
  inventory={meat:100,fruit:100,leaf:100};
  selectedFood=null;
  document.getElementById("plateFood").src="";
  updateUI();
  alert("Game direset!");
}

// Drag clone -> set makanan aktif
function initTouchDrag(){
  const foods=document.querySelectorAll(".food-item");
  const drop=document.getElementById("dropZone");

  foods.forEach(f=>{
    f.addEventListener("touchstart",e=>{
      const type=f.id.replace("food","").toLowerCase();
      if(inventory[type]<=0)return;
      const clone=f.cloneNode(true);
      clone.style.position="absolute";
      clone.style.width="40px";
      clone.style.zIndex=1000;
      document.body.appendChild(clone);

      const move=(ev)=>{
        const t=ev.touches[0];
        clone.style.left=(t.pageX-20)+"px";
        clone.style.top=(t.pageY-20)+"px";
      };
      const end=(ev)=>{
        const t=ev.changedTouches[0];
        const rect=drop.getBoundingClientRect();
        if(t.clientX>rect.left&&t.clientX<rect.right&&t.clientY>rect.top&&t.clientY<rect.bottom){
          selectedFood=type;
          document.getElementById("plateFood").src="images/"+type+".png";
          showBubble("Makanan siap di piring üçΩÔ∏è");
        }
        clone.remove();
        document.removeEventListener("touchmove",move);
        document.removeEventListener("touchend",end);
      };
      document.addEventListener("touchmove",move);
      document.addEventListener("touchend",end);
    });
  });
}
initTouchDrag();
updateUI();
</script>
</body>
</html>
