<!DOCTYPE html>
<html>
<head>
  <title>Pet Evolusi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { margin:0; text-align:center; background:#2e7d32; color:white; font-family:sans-serif; overflow-x:hidden; display:flex; flex-direction:column; align-items:center; }
    h2 { margin-top:10px; font-size:6vw; }

    #coinDisplay { position:fixed; top:5px; left:5px; font-size:4vw; background:rgba(0,0,0,0.3); padding:4px 8px; border-radius:6px; z-index:10; }

    .pet-wrapper { position:relative; display:flex; align-items:center; justify-content:center; margin-top:20px; gap:20px; }

    .glow { position:absolute; width:200px; height:200px; background:radial-gradient(circle, rgba(255,255,200,0.8) 0%, transparent 70%); animation:glow 2s infinite; border-radius:50%; z-index:0; display:none; }
    @keyframes glow { 0%,100%{opacity:0; transform:scale(1);} 50%{opacity:0.8; transform:scale(1.2);} }

    #pet { width:40vw; max-width:220px; height:auto; z-index:1; }

    .sparkle { position:absolute; width:8px; height:8px; background:white; border-radius:50%; opacity:0.8; animation:sparkleMove 1.5s forwards; pointer-events:none; z-index:2; }
    @keyframes sparkleMove { 0%{transform:translateY(0) scale(1);opacity:1;} 100%{transform:translateY(-50px) scale(0.5);opacity:0;} }

    #bubble { position:absolute; left:60%; top:20%; background:white; color:black; padding:8px 12px; border-radius:12px; display:none; max-width:180px; text-align:left; z-index:3; font-size:3.5vw; }
    #bubble::after { content:""; position:absolute; left:-10px; top:20px; border-width:10px; border-style:solid; border-color:transparent white transparent transparent; }

    .thermometer { display:flex; flex-direction:column-reverse; justify-content:flex-start; width:40px; height:220px; border:2px solid #ccc; border-radius:6px; overflow:hidden; background:#666; position:relative; }
    .bar { flex:1; margin:1px 0; background:#666; }
    .bar.active { opacity:1; }
    .bar:nth-child(2).active{background:#800000;}
    .bar:nth-child(3).active{background:#b22222;}
    .bar:nth-child(4).active{background:#ff4500;}
    .bar:nth-child(5).active{background:#ff8c00;}
    .bar:nth-child(6).active{background:#ffd700;}
    .bar:nth-child(7).active{background:#f0e68c;}
    .bar:nth-child(8).active{background:#adff2f;}
    .bar:nth-child(9).active{background:#7fff00;}
    .bar:nth-child(10).active{background:#32cd32;}
    .bar:nth-child(11).active{background:#00ff00;}

    .thermo-label { position:absolute; left:50%; transform:translateX(-50%); font-size:2.8vw; color:white; text-shadow:1px 1px 2px black; }
    #labelTop { top:2px; } #labelBottom { bottom:2px; }

    .bar-container { width:80vw; max-width:500px; margin:10px auto; background:#444; border-radius:10px; overflow:hidden; height:24px; }
    #expBar { height:100%; width:0%; text-align:center; color:white; font-size:3.5vw; line-height:24px; background:dodgerblue; transition:width 0.5s ease; }

    button { margin:10px; padding:12px 24px; font-size:4vw; border-radius:10px; }
    button:disabled { opacity:0.5; background:#777 !important; cursor:not-allowed; }

    #resetWrapper { position:fixed; top:5px; right:5px; z-index:10; }
    #resetBtn { font-size:2.5vw; padding:4px 8px; border-radius:6px; opacity:0.6; }
    #resetBtn:hover { opacity:1; }

    @keyframes breathing { 0%,100%{transform:scale(1);} 50%{transform:scale(1.05);} }
    @keyframes hungry-shake { 0%,100%{transform:translateX(0);} 25%{transform:translateX(-10px);} 75%{transform:translateX(10px);} }
    .breathing{animation:breathing 3s infinite;} .hungry{animation:hungry-shake 0.5s infinite;}

    @keyframes evoPulse { 0%,100% { transform: scale(1);} 25%{transform:scale(1.3);} 50%{transform:scale(0.7);} 75%{transform:scale(1.4);} }
    @keyframes evoPop { 0%{transform:scale(0);opacity:0;} 80%{transform:scale(1.2);opacity:1;} 100%{transform:scale(1);} }
    .evo-pulse { animation:evoPulse 2s ease-in-out; }
    .evo-pop   { animation:evoPop 0.8s ease-out; }

    /* Plate */
    #plateWrapper { position:relative; margin-top:20px; }
    #plate { width:180px; }
    #plateFood { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:50%; height:50%; object-fit:contain; display:none; }
    
    /* Food Items */
    #foodItems { display:flex; gap:15px; justify-content:center; margin-top:10px; }
    .foodItem { position:relative; width:60px; }
    .foodItem img { width:100%; }
    .count { position:absolute; bottom:0; right:0; background:rgba(0,0,0,0.7); font-size:14px; padding:2px 5px; border-radius:8px; }
  </style>
</head>
<body>
  <h2>üê£ Pet Evolusi</h2>

  <div id="coinDisplay">üí∞ 0</div>

  <div class="pet-wrapper" id="petWrapper">
    <div class="thermometer" id="thermometer">
      <div id="labelTop" class="thermo-label">Kenyang</div>
      <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
      <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
      <div id="labelBottom" class="thermo-label">Lapar</div>
    </div>

    <div class="glow" id="evoGlow"></div>
    <img id="pet" src="images/egg.png" class="breathing">
    <div id="bubble"></div>
  </div>

  <p style="font-size:4vw;">Level Pet: <span id="level">1</span></p>

  <div class="bar-container"><div id="expBar">EXP 0%</div></div>

  <!-- Tombol -->
  <button onclick="feedPet()" id="feedBtn">üçñ Feed</button>
  <button id="playBtn">üéÆ Play</button>
  <button id="evoBtn" style="display:none;" onclick="evolvePet()">‚ú® Evo Sekarang!</button>

  <div id="plateWrapper">
    <img id="plate" src="images/plate.png" alt="Piring">
    <img id="plateFood" src="" alt="">
  </div>

  <div id="foodItems">
    <div class="foodItem" ontouchstart="startDrag(event,'meat')"><img src="images/meat.png"><div class="count" id="count-meat">100</div></div>
    <div class="foodItem" ontouchstart="startDrag(event,'fruit')"><img src="images/fruit.png"><div class="count" id="count-fruit">100</div></div>
    <div class="foodItem" ontouchstart="startDrag(event,'leaf')"><img src="images/leaf.png"><div class="count" id="count-leaf">100</div></div>
  </div>

  <div id="resetWrapper"><button id="resetBtn" onclick="resetGame()">üîÑ</button></div>

  <audio id="soundFeed" src="sounds/feed.mp3" preload="auto"></audio>
  <audio id="soundLevel" src="sounds/levelup.mp3" preload="auto"></audio>
  <audio id="soundEvo" src="sounds/evo.mp3" preload="auto"></audio>

<script>
let pet = JSON.parse(localStorage.getItem("petData")) || { level:1, exp:0, stage:"egg", hunger:30, coins:0 };
let foodStock={meat:100,fruit:100,leaf:100};
let selectedFood=null;

function getPetImage(stage){
  switch(stage){ case "egg": return "images/egg.png"; case "chick": return "images/chick.png"; case "rooster": return "images/rooster.png"; case "phoenix": return "images/phoenix.png"; }
}

function updateUI(){
  document.getElementById("level").textContent=pet.level;
  document.getElementById("pet").src=getPetImage(pet.stage);
  const bars=document.querySelectorAll("#thermometer .bar");
  const activeBars=Math.round(pet.hunger/10);
  bars.forEach((bar,i)=>{ i<activeBars?bar.classList.add("active"):bar.classList.remove("active"); });
  const expBar=document.getElementById("expBar");
  expBar.style.width=pet.exp+"%"; expBar.textContent="EXP "+pet.exp+"%";
  document.getElementById("coinDisplay").textContent="üí∞ "+(pet.coins||0);
  document.getElementById("count-meat").textContent=foodStock.meat;
  document.getElementById("count-fruit").textContent=foodStock.fruit;
  document.getElementById("count-leaf").textContent=foodStock.leaf;
  localStorage.setItem("petData",JSON.stringify(pet));
}

function showBubble(t){ const b=document.getElementById("bubble"); b.textContent=t; b.style.display="block"; setTimeout(()=>b.style.display="none",2500); }
function playSound(id){const s=document.getElementById(id); if(s){s.currentTime=0;s.play();}}

function feedPet(){
  if(!selectedFood){showBubble("Pilih makanan dulu!");return;}
  if(foodStock[selectedFood]<=0){showBubble("Stok habis!");return;}
  pet.hunger=Math.min(100,pet.hunger+20);
  foodStock[selectedFood]--; pet.coins++;
  if(pet.exp>=100){
    if((pet.level===10&&pet.stage==="egg")||(pet.level===20&&pet.stage==="chick")||(pet.level===30&&pet.stage==="rooster")){
      document.getElementById("evoBtn").style.display="inline-block"; document.getElementById("evoGlow").style.display="block"; startSparkle(); showBubble("EXP penuh ‚Äî tekan Evo Sekarang!");
    } else { pet.exp=0; pet.level++; playSound("soundLevel"); showBubble("Level naik! Sekarang level "+pet.level); }
  } else { pet.exp=Math.min(100,pet.exp+10); playSound("soundFeed"); showBubble("Nyam nyam üçñ +1 koin!"); }
  if(foodStock[selectedFood]<=0){ document.getElementById("plateFood").style.display="none"; selectedFood=null; }
  updateUI();
}

function evolvePet(){
  const petImg=document.getElementById("pet"); const oldStage=pet.stage; petImg.classList.add("evo-pulse");
  setTimeout(()=>{
    if(pet.level===10&&oldStage==="egg"){pet.stage="chick";pet.coins+=50;showBubble("‚ú® Evolusi jadi Anak Ayam üê• +50 koin!");}
    else if(pet.level===20&&oldStage==="chick"){pet.stage="rooster";pet.coins+=50;showBubble("‚ú® Evolusi jadi Ayam Jantan üêì +50 koin!");}
    else if(pet.level===30&&oldStage==="rooster"){pet.stage="phoenix";pet.coins+=50;showBubble("üî• Evolusi jadi Phoenix! +50 koin!");}
    pet.exp=0; document.getElementById("evoBtn").style.display="none"; document.getElementById("evoGlow").style.display="none"; petImg.src=getPetImage(pet.stage); petImg.classList.remove("evo-pulse"); petImg.classList.add("evo-pop"); playSound("soundEvo"); updateUI(); setTimeout(()=>petImg.classList.remove("evo-pop"),1000);
  },2000);
}

setInterval(()=>{pet.hunger=Math.max(0,pet.hunger-5); if(pet.hunger<50&&Math.random()<0.3){showBubble("Aku lapar ü•∫");} updateUI();},5000);

function resetGame(){ localStorage.removeItem("petData"); pet={level:1,exp:0,stage:"egg",hunger:30,coins:0}; foodStock={meat:100,fruit:100,leaf:100}; selectedFood=null; document.getElementById("plateFood").style.display="none"; updateUI(); alert("Game direset! Pet kamu lapar ü•∫"); }

function startDrag(ev,foodType){
  ev.preventDefault();
  const touch=ev.touches[0]; const clone=document.createElement("img"); clone.src="images/"+foodType+".png"; clone.style.position="fixed"; clone.style.left=touch.clientX-30+"px"; clone.style.top=touch.clientY-30+"px"; clone.style.width="60px"; clone.style.opacity=0.8; clone.style.zIndex=1000; document.body.appendChild(clone);
  function onTouchMove(e){const t=e.touches[0]; clone.style.left=t.clientX-30+"px"; clone.style.top=t.clientY-30+"px";}
  function onTouchEnd(e){
    const plate=document.getElementById("plateWrapper").getBoundingClientRect();
    const x=e.changedTouches[0].clientX; const y=e.changedTouches[0].clientY;
    const centerX=plate.left+plate.width/2;
    const centerY=plate.top+plate.height/2 - 15; // ‚¨ÖÔ∏è geser drop zone lebih ke atas
    const dx=x-centerX; const dy=y-centerY; const distance=Math.sqrt(dx*dx+dy*dy); const radius=plate.width*0.4;
    if(distance<=radius){ if(foodStock[foodType]>0){ selectedFood=foodType; const plateFood=document.getElementById("plateFood"); plateFood.src="images/"+foodType+".png"; plateFood.style.display="block"; showBubble("üçΩÔ∏è "+foodType+" siap di piring!"); } }
    clone.remove(); document.removeEventListener("touchmove",onTouchMove); document.removeEventListener("touchend",onTouchEnd);
  }
  document.addEventListener("touchmove",onTouchMove); document.addEventListener("touchend",onTouchEnd);
}

function startSparkle(){const wrapper=document.getElementById("petWrapper"); for(let i=0;i<10;i++){setTimeout(()=>{const spark=document.createElement("span"); spark.classList.add("sparkle"); const w=wrapper.clientWidth; const h=wrapper.clientHeight; const x=(w/2)+(Math.random()*(w*0.6)-(w*0.3)); const y=(h/2)+(Math.random()*(h*0.6)-(h*0.3)); spark.style.left=x+"px"; spark.style.top=y+"px"; wrapper.appendChild(spark); setTimeout(()=>spark.remove(),1500);},i*180);}}
updateUI();
</script>
</body>
</html>
