<!DOCTYPE html>
<html>
<head>
  <title>Pet Evolusi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      text-align: center;
      background: #2e7d32;
      color: white;
      font-family: sans-serif;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h2 { margin-top: 10px; font-size: 6vw; }

    .pet-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 20px;
      gap: 20px;
    }

    .glow {
      position: absolute;
      width: 200px;
      height: 200px;
      background: radial-gradient(circle, rgba(255,255,200,0.8) 0%, transparent 70%);
      animation: glow 2s infinite;
      border-radius: 50%;
      z-index: 0;
      display: none;
    }
    @keyframes glow {
      0%, 100% { opacity: 0; transform: scale(1); }
      50% { opacity: 0.8; transform: scale(1.2); }
    }

    #pet {
      width: 40vw;
      max-width: 220px;
      height: auto;
      z-index: 1;
    }

    .sparkle {
      position: absolute;
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
      opacity: 0.8;
      animation: sparkleMove 1.5s forwards;
      pointer-events: none;
      z-index: 2;
    }
    @keyframes sparkleMove {
      0% { transform: translateY(0) scale(1); opacity: 1; }
      100% { transform: translateY(-50px) scale(0.5); opacity: 0; }
    }

    #bubble {
      position: absolute;
      left: 60%; top: 20%;
      background: white; color: black;
      padding: 8px 12px; border-radius: 12px;
      display: none; max-width: 150px; text-align: left;
      z-index: 3;
      font-size: 3.5vw;
    }
    #bubble::after {
      content: "";
      position: absolute;
      left: -10px; top: 20px;
      border-width: 10px;
      border-style: solid;
      border-color: transparent white transparent transparent;
    }

    .thermometer {
      position: relative;
      width: 6vw;
      max-width: 30px;
      height: 35vh;
      background: #888;  /* abu-abu background */
      border-radius: 15px;
      overflow: hidden;
      border: 2px solid #ccc;
      display: flex;
      flex-direction: column-reverse;
      align-items: center;
    }
    .thermo-fill {
      position: absolute; bottom: 0; width: 100%; height: 0%;
      transition: height 0.5s ease;
      background: linear-gradient(to top, darkred, red, orange, yellow, lightgreen);
    }
    .thermo-label {
      position: absolute;
      left: 110%;
      font-size: 2.5vw;
      color: white;
    }
    .thermo-label.top { top: 0; transform: translateY(-50%); }
    .thermo-label.bottom { bottom: 0; transform: translateY(50%); }

    .bar-container {
      width: 80vw;
      max-width: 500px;
      margin: 10px auto;
      background: #444; border-radius: 10px;
      overflow: hidden; height: 24px;
    }
    #expBar {
      height: 100%; width: 0%;
      text-align: center; color: white;
      font-size: 3.5vw; line-height: 24px;
      background: dodgerblue; transition: width 0.5s ease;
    }

    button {
      margin: 10px;
      padding: 12px 24px;
      font-size: 4vw;
      border-radius: 10px;
    }

    #resetWrapper {
      position: fixed;
      top: 5px;
      right: 5px;
      z-index: 10;
    }
    #resetBtn {
      font-size: 2.5vw;
      padding: 4px 8px;
      border-radius: 6px;
      opacity: 0.6;
    }
    #resetBtn:hover { opacity: 1; }

    .food-wrapper {
      position: relative;
      display: inline-block;
      margin: 5px;
    }
    .food-count {
      position: absolute;
      bottom: -5px; right: -5px;
      background: red;
      color: white;
      font-size: 2.5vw;
      padding: 2px 5px;
      border-radius: 50%;
      font-weight: bold;
    }

    @keyframes breathing {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    @keyframes hungry-shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }
    .breathing { animation: breathing 3s infinite; }
    .hungry { animation: hungry-shake 0.5s infinite; }
  </style>
</head>
<body>
  <h2>üê£ Pet Evolusi</h2>

  <div class="pet-wrapper" id="petWrapper">
    <div class="thermometer">
      <div id="thermoFill" class="thermo-fill"></div>
      <div class="thermo-label top">Kenyang</div>
      <div class="thermo-label bottom">Lapar</div>
    </div>

    <div class="glow" id="evoGlow"></div>
    <img id="pet" src="images/egg.png" class="breathing">
    <div id="bubble"></div>
  </div>
  
  <p style="font-size:4vw;">Level Pet: <span id="level">1</span> | üí∞ <span id="coins">0</span></p>

  <div class="bar-container">
    <div id="expBar">EXP 0%</div>
  </div>

  <button id="feedBtn" onclick="feedPet()" disabled>üçñ Feed</button>
  <button id="evoBtn" style="display:none;" onclick="evolvePet()">‚ú® Evo Sekarang!</button>

  <div id="foods">
    <div class="food-wrapper">
      <img src="images/meat.png" class="food" data-type="meat">
      <div class="food-count" id="count-meat">100</div>
    </div>
    <div class="food-wrapper">
      <img src="images/fruit.png" class="food" data-type="fruit">
      <div class="food-count" id="count-fruit">100</div>
    </div>
    <div class="food-wrapper">
      <img src="images/leaf.png" class="food" data-type="leaf">
      <div class="food-count" id="count-leaf">100</div>
    </div>
  </div>

  <div id="plate" style="font-size:8vw; margin:15px;">üçΩÔ∏è</div>

  <div id="resetWrapper">
    <button id="resetBtn" onclick="resetGame()">üîÑ</button>
  </div>

<script>
let pet = JSON.parse(localStorage.getItem("petData")) || { 
  level: 1, exp: 0, stage: "egg", hunger: 30, coins: 0 
};

let inventory = { meat:100, fruit:100, leaf:100 };
const plate = document.getElementById("plate");

function getPetImage(stage){
  switch(stage){
    case "egg": return "images/egg.png";
    case "chick": return "images/chick.png";
    case "rooster": return "images/rooster.png";
    case "phoenix": return "images/phoenix.png";
    default: return "images/egg.png";
  }
}

function updateUI(){
  document.getElementById("level").textContent = pet.level;
  document.getElementById("coins").textContent = pet.coins;
  document.getElementById("pet").src = getPetImage(pet.stage);

  document.getElementById("thermoFill").style.height = pet.hunger + "%";

  const expBar = document.getElementById("expBar");
  expBar.style.width = pet.exp + "%";
  expBar.textContent = "EXP " + pet.exp + "%";

  const petImg = document.getElementById("pet");
  if(pet.hunger <= 30) {
    petImg.classList.remove("breathing");
    petImg.classList.add("hungry");
  } else {
    petImg.classList.remove("hungry");
    petImg.classList.add("breathing");
  }

  localStorage.setItem("petData", JSON.stringify(pet));
  updateInventoryUI();
}

function updateInventoryUI(){
  document.getElementById("count-meat").textContent = inventory.meat>0 ? inventory.meat : "";
  document.getElementById("count-fruit").textContent = inventory.fruit>0 ? inventory.fruit : "";
  document.getElementById("count-leaf").textContent = inventory.leaf>0 ? inventory.leaf : "";

  document.querySelectorAll(".food").forEach(food=>{
    const type=food.dataset.type;
    food.style.display = (inventory[type]>0) ? "inline" : "none";
  });
}

function showBubble(text){
  const bubble = document.getElementById("bubble");
  bubble.textContent = text;
  bubble.style.display = "block";
  setTimeout(()=> bubble.style.display="none", 2500);
}

function feedPet(){
  if(!plate.dataset.foodType) return;
  const type=plate.dataset.foodType;

  if(inventory[type] <= 0){ 
    showBubble("Item habis ‚ùå"); 
    plate.innerHTML="üçΩÔ∏è"; 
    delete plate.dataset.foodType;
    document.getElementById("feedBtn").disabled=true;
    return;
  }

  let hungerGain=0, expGain=0;
  if(type==="meat"){ hungerGain=1; expGain=2; }
  if(type==="fruit"){ hungerGain=1; expGain=1; }
  if(type==="leaf"){ hungerGain=1; expGain=0.5; }

  pet.hunger=Math.min(100, pet.hunger+hungerGain);
  pet.exp=Math.min(100, pet.exp+expGain);
  pet.coins++;
  inventory[type]--; 
  updateInventoryUI();

  // --- LOGIKA LEVEL UP ---
  if(pet.exp >= 100){
    if((pet.level===10 && pet.stage==="egg") ||
       (pet.level===20 && pet.stage==="chick") ||
       (pet.level===30 && pet.stage==="rooster")){
      pet.exp = 100;
      document.getElementById("evoBtn").style.display="inline-block";
      document.getElementById("evoGlow").style.display="block";
    } else {
      pet.level++;
      pet.exp = 0;
      showBubble("‚¨ÜÔ∏è Level naik jadi "+pet.level+"!");
    }
  }

  showBubble("Pet makan "+type+" üç¥");
  plate.innerHTML="üçΩÔ∏è"; delete plate.dataset.foodType;
  document.getElementById("feedBtn").disabled=true;
  updateUI();
}

function evolvePet(){
  if(pet.level===10 && pet.stage==="egg"){ pet.stage="chick"; showBubble("‚ú® Evolusi jadi Anak Ayam üê•"); }
  else if(pet.level===20 && pet.stage==="chick"){ pet.stage="rooster"; showBubble("‚ú® Evolusi jadi Ayam Jantan üêì"); }
  else if(pet.level===30 && pet.stage==="rooster"){ pet.stage="phoenix"; showBubble("üî• Evolusi jadi Phoenix!"); }

  pet.exp=0;
  document.getElementById("evoBtn").style.display="none";
  document.getElementById("evoGlow").style.display="none";
  updateUI();
}

setInterval(()=>{
  pet.hunger = Math.max(0, pet.hunger - 5);
  if(pet.hunger < 50 && Math.random() < 0.3){
    showBubble("Aku lapar ü•∫");
  }
  updateUI();
}, 5000);

function resetGame(){
  localStorage.removeItem("petData");
  pet = { level:1, exp:0, stage:"egg", hunger:30, coins:0 };
  inventory = { meat:100, fruit:100, leaf:100 };
  updateUI();
  alert("Game direset! Pet kamu lapar ü•∫");
}

// --- Drag & Drop Mobile pakai clone ---
document.querySelectorAll(".food").forEach(food=>{
  let clone=null;
  food.addEventListener("touchstart", e=>{
    const touch = e.touches[0];
    clone=food.cloneNode(true);
    clone.style.position="fixed";
    clone.style.left=(touch.clientX-25)+"px";
    clone.style.top=(touch.clientY-25)+"px";
    clone.style.width="50px";
    clone.style.pointerEvents="none";
    clone.style.opacity="0.8";
    document.body.appendChild(clone);
  });
  food.addEventListener("touchmove", e=>{
    if(!clone) return;
    e.preventDefault();
    const touch=e.touches[0];
    clone.style.left=(touch.clientX-25)+"px";
    clone.style.top=(touch.clientY-25)+"px";
  },{passive:false});
  food.addEventListener("touchend", e=>{
    if(!clone) return;
    const plateRect=plate.getBoundingClientRect();
    const cloneRect=clone.getBoundingClientRect();
    if(!(cloneRect.right<plateRect.left||cloneRect.left>plateRect.right||
         cloneRect.bottom<plateRect.top||cloneRect.top>plateRect.bottom)){
      const type=food.dataset.type;
      if(inventory[type]>0){
        plate.innerHTML="";
        const img=document.createElement("img");
        img.src="images/"+type+".png"; img.width=40;
        plate.appendChild(img);
        plate.dataset.foodType=type;
        document.getElementById("feedBtn").disabled=false;
      }
    }
    document.body.removeChild(clone);
    clone=null;
  });
});

updateUI();
</script>
</body>
</html>
