<!DOCTYPE html>
<html>
<head>
  <title>Pet Evolusi Final Mobile Drag</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { margin:0; text-align:center; background:#2e7d32; color:white; font-family:sans-serif; overflow-x:hidden; display:flex; flex-direction:column; align-items:center; }
    h2 { margin-top:10px; font-size:6vw; }

    #coinDisplay { position: fixed; top:5px; left:5px; font-size:4vw; background:rgba(0,0,0,0.3); padding:4px 8px; border-radius:6px; z-index:10; }
    #shopBtn { position: fixed; top:45px; left:5px; font-size:5vw; background:#444; border-radius:50%; padding:6px; z-index:10; cursor:pointer; }
    #shopPopup { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#fff; color:#000; padding:20px; border-radius:10px; z-index:20; width:80%; max-width:300px; }
    #shopPopup button { margin-top:10px; }

    .pet-wrapper { position:relative; display:flex; align-items:center; justify-content:center; margin-top:20px; gap:20px; }

    .glow { position:absolute; width:200px; height:200px; background:radial-gradient(circle, rgba(255,255,200,0.8) 0%, transparent 70%); animation:glow 2s infinite; border-radius:50%; z-index:0; display:none; }
    @keyframes glow { 0%,100%{opacity:0; transform:scale(1);} 50%{opacity:0.8; transform:scale(1.2);} }

    #pet { width:40vw; max-width:220px; height:auto; z-index:1; }

    #bubble { position:absolute; left:60%; top:20%; background:white; color:black; padding:8px 12px; border-radius:12px; display:none; max-width:180px; text-align:left; z-index:3; font-size:3.5vw; }

    .thermometer { display:flex; flex-direction:column-reverse; width:40px; height:220px; border:2px solid #ccc; border-radius:6px; overflow:hidden; background:#666; position:relative; }
    .bar { flex:1; margin:1px 0; background:#666; }
    .bar.active { opacity:1; }
    .bar:nth-child(2).active{background:#800000;} .bar:nth-child(3).active{background:#b22222;}
    .bar:nth-child(4).active{background:#ff4500;} .bar:nth-child(5).active{background:#ff8c00;}
    .bar:nth-child(6).active{background:#ffd700;} .bar:nth-child(7).active{background:#f0e68c;}
    .bar:nth-child(8).active{background:#adff2f;} .bar:nth-child(9).active{background:#7fff00;}
    .bar:nth-child(10).active{background:#32cd32;} .bar:nth-child(11).active{background:#00ff00;}
    .thermo-label { position:absolute; left:50%; transform:translateX(-50%); font-size:2.8vw; color:white; text-shadow:1px 1px 2px black; }
    #labelTop { top:2px; } #labelBottom { bottom:2px; }

    .bar-container { width:80vw; max-width:500px; margin:10px auto; background:#444; border-radius:10px; overflow:hidden; height:24px; }
    #expBar { height:100%; width:0%; text-align:center; color:white; font-size:3.5vw; line-height:24px; background:dodgerblue; transition:width 0.5s ease; }

    .btn-row { display:flex; justify-content:center; gap:10px; margin-top:10px; }
    button { margin:10px; padding:12px 24px; font-size:4vw; border-radius:10px; }
    button:disabled { opacity:0.5; background:#777 !important; cursor:not-allowed; }

    #resetWrapper { position:fixed; top:5px; right:5px; z-index:10; }
    #resetBtn { font-size:2.5vw; padding:4px 8px; border-radius:6px; opacity:0.6; }

    #plateWrapper { position:relative; margin-top:20px; }
    #plate { width:150px; }
    #dropZone { position:absolute; top:40%; left:50%; transform:translate(-50%,-50%); width:80px; height:80px; z-index:5; }
    #dropZone img { width:60px; }

    .food-items { display:flex; justify-content:center; gap:15px; margin-top:5px; }
    .food { position:relative; }
    .food img { width:50px; cursor:grab; }
    .food span { position:absolute; bottom:-5px; right:-5px; background:red; color:white; font-size:3vw; border-radius:50%; padding:2px 5px; }
  </style>
</head>
<body>
  <h2>üê£ Pet Evolusi</h2>

  <div id="coinDisplay">üí∞ 0</div>
  <div id="shopBtn" onclick="toggleShop()">üõí</div>
  <div id="shopPopup"><h3>Shop</h3><p>Belum ada item dijual...</p><button onclick="toggleShop()">Tutup</button></div>

  <div class="pet-wrapper" id="petWrapper">
    <div class="thermometer" id="thermometer">
      <div id="labelTop" class="thermo-label">Kenyang</div>
      <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
      <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
      <div id="labelBottom" class="thermo-label">Lapar</div>
    </div>
    <div class="glow" id="evoGlow"></div>
    <img id="pet" src="images/egg.png" class="breathing">
    <div id="bubble"></div>
  </div>

  <p style="font-size:4vw;">Level Pet: <span id="level">1</span></p>
  <div class="bar-container"><div id="expBar">EXP 0%</div></div>

  <div class="btn-row">
    <button onclick="feedPet()" id="feedBtn">üçñ Feed</button>
    <button onclick="playPet()" id="playBtn">üéÆ Play</button>
    <button id="evoBtn" style="display:none;" onclick="evolvePet()">‚ú® Evo</button>
  </div>

  <div id="plateWrapper">
    <img id="plate" src="images/plate.png">
    <div id="dropZone"></div>
  </div>

  <div class="food-items">
    <div class="food"><img src="images/meat.png" draggable="true" data-type="meat"><span id="stock-meat">100</span></div>
    <div class="food"><img src="images/fruit.png" draggable="true" data-type="fruit"><span id="stock-fruit">100</span></div>
    <div class="food"><img src="images/leaf.png" draggable="true" data-type="leaf"><span id="stock-leaf">100</span></div>
  </div>

  <div id="resetWrapper"><button id="resetBtn" onclick="resetGame()">üîÑ</button></div>

<script>
let pet = JSON.parse(localStorage.getItem("petData")) || { level:1, exp:0, stage:"egg", hunger:30, coins:0 };
let stocks = JSON.parse(localStorage.getItem("foodStocks")) || { meat:100, fruit:100, leaf:100 };
let currentFood = null;

function getPetImage(stage){
  switch(stage){
    case "egg": return "images/egg.png";
    case "chick": return "images/chick.png";
    case "rooster": return "images/rooster.png";
    case "phoenix": return "images/phoenix.png";
    default: return "images/egg.png";
  }
}
function updateUI(){
  document.getElementById("level").textContent = pet.level;
  document.getElementById("pet").src = getPetImage(pet.stage);
  const bars=document.querySelectorAll("#thermometer .bar");
  const activeBars=Math.round(pet.hunger/10);
  bars.forEach((bar,i)=>{i<activeBars?bar.classList.add("active"):bar.classList.remove("active");});
  const expBar=document.getElementById("expBar");
  expBar.style.width=pet.exp+"%"; expBar.textContent="EXP "+pet.exp+"%";
  document.getElementById("coinDisplay").textContent="üí∞ "+pet.coins;
  document.getElementById("stock-meat").textContent=stocks.meat;
  document.getElementById("stock-fruit").textContent=stocks.fruit;
  document.getElementById("stock-leaf").textContent=stocks.leaf;
  localStorage.setItem("petData", JSON.stringify(pet));
  localStorage.setItem("foodStocks", JSON.stringify(stocks));
}
function showBubble(text){const b=document.getElementById("bubble");b.textContent=text;b.style.display="block";setTimeout(()=>b.style.display="none",2500);}
function feedPet(){
  if(!currentFood){showBubble("Taruh makanan dulu üçñüçéüçÉ");return;}
  if(stocks[currentFood]<=0){showBubble("Stok habis!");return;}
  pet.hunger=Math.min(100, pet.hunger+10); pet.coins++;
  if(currentFood==="meat") pet.exp=Math.min(100, pet.exp+10);
  if(currentFood==="fruit") pet.exp=Math.min(100, pet.exp+5);
  if(currentFood==="leaf") pet.exp=Math.min(100, pet.exp+2.5);
  stocks[currentFood]--;
  const evoLevel=(pet.level===10&&pet.stage==="egg")||(pet.level===20&&pet.stage==="chick")||(pet.level===30&&pet.stage==="rooster");
  if(pet.exp>=100){
    if(evoLevel){document.getElementById("evoBtn").style.display="inline-block";document.getElementById("evoGlow").style.display="block";showBubble("EXP penuh! Evo sekarang?");}
    else{pet.exp=0; pet.level++; showBubble("Level naik! Sekarang "+pet.level);}
  }
  updateUI();
}
function evolvePet(){const petImg=document.getElementById("pet");const oldStage=pet.stage;petImg.classList.add("evo-pulse");
  setTimeout(()=>{
    if(pet.level===10&&oldStage==="egg"){pet.stage="chick";showBubble("üê• Jadi Anak Ayam!");}
    else if(pet.level===20&&oldStage==="chick"){pet.stage="rooster";showBubble("üêì Jadi Ayam Jantan!");}
    else if(pet.level===30&&oldStage==="rooster"){pet.stage="phoenix";showBubble("üî• Jadi Phoenix!");}
    pet.exp=0; document.getElementById("evoBtn").style.display="none"; document.getElementById("evoGlow").style.display="none";
    petImg.src=getPetImage(pet.stage); petImg.classList.remove("evo-pulse"); petImg.classList.add("evo-pop");
    setTimeout(()=>petImg.classList.remove("evo-pop"),1000); updateUI();
  },2000);}
function resetGame(){localStorage.clear();pet={level:1,exp:0,stage:"egg",hunger:30,coins:0};stocks={meat:100,fruit:100,leaf:100};currentFood=null;document.getElementById("dropZone").innerHTML="";updateUI();alert("Reset berhasil!");}
function toggleShop(){const popup=document.getElementById("shopPopup");popup.style.display=(popup.style.display==="block")?"none":"block";}

/* Desktop drag */
document.querySelectorAll(".food img").forEach(img=>{
  img.addEventListener("dragstart", e=>{e.dataTransfer.setData("food", img.dataset.type);});
});
const dropZone=document.getElementById("dropZone");
dropZone.addEventListener("dragover", e=> e.preventDefault());
dropZone.addEventListener("drop", e=>{
  e.preventDefault(); const type=e.dataTransfer.getData("food"); if(!type) return;
  currentFood=type; dropZone.innerHTML=`<img src="images/${type}.png">`;
});

/* Mobile touch drag simulation */
document.querySelectorAll(".food img").forEach(img=>{
  img.addEventListener("touchstart", e=>{
    e.preventDefault(); currentFood=img.dataset.type;
    dropZone.innerHTML=`<img src="images/${currentFood}.png">`;
  });
});

setInterval(()=>{pet.hunger=Math.max(0, pet.hunger-5);updateUI();},5000);
updateUI();
</script>
</body>
</html>
